<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Java to Go language - My Development Cookbook</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">My Development Cookbook</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="java-to-go-language"><a class="header" href="#java-to-go-language">Java to Go language</a></h1>
<p>I have written large Java projects in the past, I have used proprietary
tools to turn them into native executable. The Go language provides a nice
alternative with several important advantages. Now I am looking into some
automated way to convert may Java codes into Go with minimal manual
conversions. LLVM, antlr and other tools I am looking at. This will be a
work in progress for near future.</p>
<h2 id="links"><a class="header" href="#links">Links</a></h2>
<ul>
<li><a href="https://github.com/dglo/java2go">https://github.com/dglo/java2go</a>.</li>
<li><a href="https://github.com/andrewarrow/traot">https://github.com/andrewarrow/traot</a>.</li>
<li><a href="https://talks.golang.org/2015/go-for-java-programmers.slide">https://talks.golang.org/2015/go-for-java-programmers.slide</a>.</li>
<li><a href="https://talks.golang.org/2015/go-for-java-programmers">https://talks.golang.org/2015/go-for-java-programmers</a>.</li>
<li><a href="https://talks.golang.org">https://talks.golang.org</a>.</li>
</ul>
<h2 id="llvm"><a class="header" href="#llvm">LLVM</a></h2>
<ul>
<li><a href="https://youtu.be/a5-WaD8VV38">A Brief Introduction to LLVM</a>.</li>
<li><a href="https://youtu.be/VKIv_Bkp4pk">Introduction to LLVM Building simple program analysis tools and instrumentation</a>.</li>
</ul>
<h2 id="polyglot"><a class="header" href="#polyglot">Polyglot</a></h2>
<ul>
<li><a href="https://research.cs.cornell.edu/polyglot/">An open compiler front end framework for
building Java language extensions</a>.</li>
</ul>
<h2 id="graal"><a class="header" href="#graal">GRAAL</a></h2>
<ul>
<li><a href="https://youtu.be/14hqB7Q0I58">How to Create a New JVM Language in Under an Hour by Oleg Šelajev</a>.</li>
</ul>
<h2 id="some-info-on-go"><a class="header" href="#some-info-on-go">Some info on go</a></h2>
<ul>
<li>Default go library install path for a user in windows, <code>%UserProfile%\go</code> directory. Check <a href="https://superuser.com/questions/217504/is-there-a-list-of-windows-special-directories-shortcuts-like-temp">Windows special directories/shortcuts</a> for similar paths in windows.</li>
<li>Pigeon is a PEG based parser generator in go. We can use antlr java grammar from and convert in a Pigeon gammer file and use Pigeon to parse.
Check <a href="https://pkg.go.dev/github.com/mna/pigeon?tab=doc">Documentation</a>.</li>
</ul>
<h2 id="use-antlr-and-keep-everything-in-java-world-to-translate"><a class="header" href="#use-antlr-and-keep-everything-in-java-world-to-translate">Use antlr and keep everything in Java world to translate</a></h2>
<h2 id="use-antlr-to-generate-a-java-parser-in-with-golang"><a class="header" href="#use-antlr-to-generate-a-java-parser-in-with-golang">Use antlr to generate a java parser in with golang</a></h2>
<p>I prefer this option. This seems to be the path of lease resistance for now.</p>
<ul>
<li><a href="https://blog.gopheracademy.com/advent-2017/parsing-with-antlr4-and-go/">Parsing with ANTLR 4 and Go</a>.
The author has already created golang parsers for all available grammars in (Github)[https://github.com/bramp/antlr4-grammars.git].</li>
</ul>
<h2 id="manual-porting"><a class="header" href="#manual-porting">Manual porting</a></h2>
<ul>
<li><a href="https://blog.kowalczyk.info/article/19f2fe97f06a47c3b1f118fd06851fad/lessons-learned-porting-50k-loc-from-java-to-go.html">Lessons learned porting 50k loc from Java to Go</a></li>
</ul>
<p>Edited excerpts from the article,</p>
<h3 id="string-vs-string"><a class="header" href="#string-vs-string">String vs. string</a></h3>
<p>In Java, <code>String</code> is an object
that really is a reference (a pointer). As a result, a string can be <code>null</code>.
In Go <code>string</code> is a value type.
It can't be <code>nil</code>, only empty.</p>
<blockquote>
<p>Idea: mechanically replace <code>null</code> with <code>""</code>.</p>
</blockquote>
<h3 id="errors-vs-exceptions"><a class="header" href="#errors-vs-exceptions">Errors vs. exceptions</a></h3>
<p>Java uses exceptions to communicate errors.
Go returns values of <code>error</code>
interface.</p>
<blockquote>
<p>Idea: Change function signatures to return error values and propagate them up the call
stack.</p>
</blockquote>
<h3 id="generics"><a class="header" href="#generics">Generics</a></h3>
<p>Go doesn't have Generics.
Porting generic APIs was the biggest
challenge.</p>
<p>Here's an example of a generic method in
Java:</p>
<pre><code>public &lt;T&gt; T load(Class&lt;T&gt; clazz, String id) {
</code></pre>
<p>And the caller:</p>
<pre><code>Foo foo = load(Foo.class, "id")
</code></pre>
<p>Two strategies can be useful.</p>
<p>One is to use <code>interface{}</code>,
which combines value and its type, similar to <code>object</code> in Java. This is not preferred
approach. While it works, operating on <code>interface{}</code> is clumsy for the user of the
library.</p>
<p>The other is to use reflection
and the above code was ported as:</p>
<pre><code>func Load(result interface{}, id string) error
</code></pre>
<p>Reflection to query type of
<code>result</code> can be used to create values of that type from JSON document.</p>
<p>And the caller side:</p>
<pre><code>var result *Foo
err := Load(&amp;result, "id")
</code></pre>
<h3 id="function-overloading"><a class="header" href="#function-overloading">Function overloading</a></h3>
<p>Go doesn't have overloading.</p>
<p>Java:</p>
<pre><code>void foo(int a, String b) {}
void foo(int a) { foo(a, null); }
</code></pre>
<p>In go write 2 functions instead:</p>
<pre><code>func foo(a int) {}
func fooWithB(a int, b string) {}
</code></pre>
<p>When number of potential arguments was large
use a struct:</p>
<pre><code>type FooArgs struct {
	A int
	B string
}
func foo(args *FooArgs) { }
</code></pre>
<h3 id="inheritance"><a class="header" href="#inheritance">Inheritance</a></h3>
<p>Go is not especially object-oriented and
doesn't have inheritance.
Simple cases of inheritance can be ported
with embedding.</p>
<pre><code>class B : A { }
</code></pre>
<p>Can sometimes be ported as:</p>
<pre><code>type A struct { }
type B struct {
	A
}
</code></pre>
<p>We've embedded <code>A</code> inside
<code>B</code>, so <code>B</code> inherit all the methods and fields of <code>A</code>.</p>
<p>It doesn't work for virtual functions.
There is no good way to directly port code
that uses virtual functions.
One option to emulate virtual function is to
use embedding of structs and function pointers. This essentially re-implements virtual table
that Java gives you for free as part of <code>object</code> implementation.</p>
<p>Another option is to write a stand-alone
function that dispatches the right function for a given type by using type switch.</p>
<h3 id="interfaces"><a class="header" href="#interfaces">Interfaces</a></h3>
<p>Both Java and Go have interfaces but they
are different things. You can create a Go interface type
that replicated Java interface.</p>
<p>Or just dont use interfaces, instead use exposed concrete structs in the API.</p>
<h3 id="circular-imports-between-packages"><a class="header" href="#circular-imports-between-packages">Circular imports between packages</a></h3>
<p>Java allows circular imports between
packages.
Go does not.
As a result you will not able to replicate the
package structure of Java code. Restructuring will be needed.</p>
<h3 id="private-public-protected"><a class="header" href="#private-public-protected">Private, public, protected</a></h3>
<p>Go simplified access by only having public vs.
private and scoping access to package level.</p>
<h3 id="concurrency"><a class="header" href="#concurrency">Concurrency</a></h3>
<p>Go's concurrency is simply the best and a
built-in race detector is of great help in repelling concurrency bugs.</p>
<p>Mechanical translation will require
restructuring it to be more Go idiomatic.</p>
<h3 id="fluent-function-chaining"><a class="header" href="#fluent-function-chaining">Fluent function chaining</a></h3>
<p>Java has function chaining like this,</p>
<pre><code>List&lt;ReduceResult&gt; results = session.query(User.class)
                        .groupBy("name")
                        .selectKey()
                        .selectCount()
                        .orderByDescending("count")
                        .ofType(ReduceResult.class)
                        .toList();
</code></pre>
<p>This only works in languages that
communicate errors via exceptions. When a function additionally returns an error, it's no longer
possible to chain it like that.</p>
<p>To replicate chaining in Go,
"stateful error" approach would be useful:</p>
<pre><code>type Query struct {
	err error
}

func (q *Query) WhereEquals(field string, val interface{}) *Query {
	if q.err != nil {
		return q
	}
	// logic that might set q.err
	return q
}

func (q *Query) GroupBy(field string) *Query {
if q.err != nil {
		return q
	}
	// logic that might set q.err
	return q
}

func (q *Query) Execute(result interface{}) error {
	if q.err != nil {
		return q.err
	}
	// do logic
}
</code></pre>
<p>This can be chained:</p>
<pre><code>var result *Foo
err := NewQuery().WhereEquals("Name", "Frank").GroupBy("Age").Execute(&amp;result)
</code></pre>
<h3 id="go-code-is-shorter"><a class="header" href="#go-code-is-shorter">Go code is shorter</a></h3>
<p>This is not so much a property of Java but
the culture which dictates what is considered an idiomatic code.</p>
<p>In Java setter and getter methods are
common. As a result, Java code:</p>
<pre><code>class Foo {
	private int bar;

	public void setBar(int bar) {
		this.bar = bar;
	}

	public int getBar() {
		return this.bar;
	}
}
</code></pre>
<p>ends up in Go as:</p>
<pre><code>type Foo struct {
	Bar int
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../topics/pythoncli.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../topics/java2js.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../topics/pythoncli.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../topics/java2js.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
