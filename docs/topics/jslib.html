<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Javascript library - My Development Cookbook</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">My Development Cookbook</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="javascript-library"><a class="header" href="#javascript-library">Javascript library</a></h1>
<h2 id="using-require-like-a-node-package-in-browser"><a class="header" href="#using-require-like-a-node-package-in-browser">Using require like a node package in browser</a></h2>
<p>Lets take an example where we will use node package in a <code>commonjs</code> javascript file. This kind of setup would work in a node environment without
problem. But in a browser using <code>require</code> would normally be a problem. We can use the following method to make it work in browser.</p>
<p>In this example we will instantiate jquery with <code>require</code> as a node module. First get jquery module using npm. Then make <code>test.js</code> module as following.
At the end of the file we will export the API.</p>
<pre><code class="language-javascript">var $ = require("jquery");

function getName () {
  return 'Jim';
};

function getLocation () {
  return 'Munich';
};

function injectEl() {
  // wait till document is ready 
  $(function() {
    $("&lt;h1&gt;This text was injected using jquery&lt;/h1&gt;").appendTo(".inject-dev");
  });
}

const dob = '12.01.1982';

module.exports.getName = getName;
module.exports.getLocation = getLocation;
module.exports.dob = dob;
module.exports.injectEl = injectEl;
</code></pre>
<p>Now wrap everything up in a single module.
You have two options,</p>
<ul>
<li>Use <code>browserify</code>.</li>
<li>Use <code>rollup</code>.</li>
</ul>
<h2 id="use-browserify"><a class="header" href="#use-browserify">Use browserify</a></h2>
<p>Assuming you have already installed <code>browserify</code> and <code>js-beautify</code>, run them. If node builtins are used your <code>commonjs</code> file, <code>browserify --s</code> option will include them.</p>
<pre><code class="language-bash">browserify test.js --s test -o gen-test.js
#optional only if you like to examine the generated file.
js-beautify gen-test.js -o pretty-gen-test.js
</code></pre>
<p>Check the outputs, you can see jquery has already been included in the output.</p>
<p>Now we can load <code>gen-test.js</code> in the browser in an html file. It also works with svelte. Following shows using it in a svelte source.</p>
<pre><code class="language-html">&lt;script&gt;
  import { onMount } from 'svelte';
  import test from "./gen-test.js"

  let name = test.getName();
  let location = test.getLocation();
  let dob = test.dob;

  test.injectEl();
&lt;/script&gt;

&lt;main&gt;
  &lt;h1&gt;Hello {name}!&lt;/h1&gt;
  &lt;p&gt;Location: {location}, dob: {dob}&lt;/p&gt;
  &lt;div class="inject-dev"&gt;&lt;/div&gt;
&lt;/main&gt;
</code></pre>
<p>I have built this as an npm project in <a href="https://github.com/kkibria/svelte-js-library">github</a> with svelte template.</p>
<h2 id="use-rollup"><a class="header" href="#use-rollup">Use rollup</a></h2>
<p>If you have installed <code>rollup</code> this can also be done with added benefit of <a href="#tree-shaking-with-rollup">tree shaking</a>. <code>rollup.config.js</code> can be configured as,</p>
<pre><code class="language-javascript">import resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';
export default {
  ...
  plugins: [
    resolve({
      browser: true,

      // only if you need rollup to look inside
      // node_modules for builtins
      preferBuiltins: false, 

      dedupe: ['svelte']
    }),
    json(),
    commonjs()
  ]
}
</code></pre>
<h3 id="node-builtins"><a class="header" href="#node-builtins">node builtins</a></h3>
<p>Read <a href="https://github.com/rollup/plugins/tree/master/packages/node-resolve">node-resolve documentation</a> carefully.
If node builtins are used your <code>commonjs</code> file, they will be missing. You have two options,</p>
<ul>
<li>Import the individual builtin packages with npm, if you have only a few missing. Set <code>preferBuiltins</code> to <code>false</code>
so that rollup can get them from <code>node_modules</code>.</li>
<li>All node builtins can be included using npm packages <code>rollup-plugin-node-builtins</code> and <code>rollup-plugin-node-globals</code> with rollup. Set <code>preferBuiltins</code> to <code>true</code> so that rollup will use builtins from these instead. You can remove <code>preferBuiltins</code> altogether since<br />
it default value is <code>true</code> anyways.</li>
</ul>
<h2 id="create-javascript-for-older-browsers"><a class="header" href="#create-javascript-for-older-browsers">Create javascript for older browsers</a></h2>
<p>The way to fix language version problems is transpiling the javascript code using <a href="https://babeljs.io/"><strong>babel</strong></a>. To make sure transpiled code works on older browser, we have to test it on different browsers to see if and why it fails. Cross browser testing sites like <a href="https://www.lambdatest.com">https://www.lambdatest.com</a> or <a href="https://saucelabs.com/">https://saucelabs.com/</a> are helpful but can be expansive depending on situation. Check the following to get an insight,</p>
<ul>
<li><a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/">babel Handbook</a>.</li>
<li>Browser support for javascript, <a href="https://kangax.github.io/compat-table/es6/">ECMAScript compatibility table</a>.</li>
<li>Youtube video, <a href="https://youtu.be/MzZilaM16oY">Do you really need BABEL to compile JavaScript</a>?</li>
<li><a href="https://medium.com/@makk.bit/babel-under-the-hood-63e3fb961243">Babel under the hood</a>.</li>
</ul>
<h3 id="babel-with-rollup"><a class="header" href="#babel-with-rollup">babel with rollup</a></h3>
<p>Read <a href="https://github.com/rollup/plugins/tree/master/packages/babel">rollup babel plugin documentation</a> carefully to understand how to configure the plugin. This plugin
will invoke babel.
Next we need to understand how to configure babel, read <a href="https://babeljs.io/docs/en/configuration">Babel configuration documentation</a>.</p>
<ul>
<li><a href="https://blog.az.sg/posts/svelte-and-ie11/">Making a svelte app compatible with Internet Explorer 11</a>.</li>
<li><a href="http://simey.me/svelte3-rollup-and-babel7/">Svelte3, Rollup and Babel7</a>.</li>
</ul>
<h3 id="babel-with-webpack"><a class="header" href="#babel-with-webpack">babel with webpack</a></h3>
<ul>
<li><a href="https://dillinger.io/">Dillinger</a> is a good example, Github <a href="https://github.com/joemccann/dillinger">source</a>. I tried their site on IE11 and it worked fine.</li>
<li>Good info on using babel in the Github <a href="https://github.com/babel/babel-loader">source</a> readme of the webpack plugin <code>babel-loader</code>.</li>
<li><a href="https://medium.com/@ramez.aijaz/transpile-typescript-to-es5-using-babel-and-webpack-f3b72a157399">Support IE 11 Using Babel and Webpack</a></li>
</ul>
<h2 id="polyfill-articles"><a class="header" href="#polyfill-articles">Polyfill articles</a></h2>
<ul>
<li><a href="https://medium.com/hackernoon/polyfills-everything-you-ever-wanted-to-know-or-maybe-a-bit-less-7c8de164e423">Polyfills: everything you ever wanted to know, or maybe a bit less</a>.</li>
<li><a href="https://philipwalton.com/articles/loading-polyfills-only-when-needed/">Loading Polyfills Only When Needed</a>.</li>
</ul>
<h2 id="file-io-from-browsers"><a class="header" href="#file-io-from-browsers">File io from browsers</a></h2>
<ul>
<li><a href="http://simey.me/saving-loading-files-with-javascript/">Saving / Loading files with Javascript (from the browser)</a></li>
</ul>
<h2 id="tree-shaking-with-rollup"><a class="header" href="#tree-shaking-with-rollup">Tree shaking with rollup</a></h2>
<ul>
<li><a href="https://madewithlove.com/optimizing-javascript-packages-for-tree-shaking/">Optimizing JavaScript packages for tree shaking</a>.</li>
<li><a href="https://medium.com/@paleo.said/how-to-bundle-an-npm-package-with-typescript-and-rollup-f80e0f196189">How to bundle a npm package with TypeScript and Rollup</a>.</li>
</ul>
<h2 id="typescript"><a class="header" href="#typescript">TypeScript</a></h2>
<p>We can automatically compile typescript files by running typescript compiler in watch mode,</p>
<pre><code class="language-bash">tsc *.ts --watch
</code></pre>
<p>Check out more details on <a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html"><code>tsconfig.json</code></a> usage.</p>
<h2 id="best-way-to-provide-module-api"><a class="header" href="#best-way-to-provide-module-api">Best way to provide module API</a></h2>
<p>I like using Javascript class to provide prototypical APIs that uses states.
APIs without states can be exported as functions.</p>
<h2 id="js-asynchronous-programming-promise-asyncawait-explained"><a class="header" href="#js-asynchronous-programming-promise-asyncawait-explained">js asynchronous programming: Promise(), async/await explained</a></h2>
<p>Traditionally, we would access the results of asynchronous code through the use of callbacks.</p>
<pre><code class="language-javascript">let myfunc = (maybeAnID) =&gt; {
  someDatabaseThing(maybeAnID, function(error, result)) {
    if(error) {
      // build an error object and return
      // or just process the error and log and return nothing
      return doSomethingWithTheError(error);
    } else {
      // process the result, build a return object and return
      // or just process result and return nothing
      return doSomethingWithResult(result);
    }
  }
}
</code></pre>
<p>The use of callbacks is ok until they become overly nested. In other words, you have to run more asynchronous code with each new result. This pattern of callbacks within callbacks can lead to something known as <em>callback hell</em>.</p>
<p>To solve this we can use promise.
A promise is simply an object that we create like the later example. We instantiate it with the <code>new</code> keyword. Instead of the three parameters we passed in to make our car (color, type, and doors), we pass in a function that takes two arguments: <code>resolve</code> and <code>reject</code>.</p>
<pre><code class="language-javascript">
let myfunc = (maybeAnID) =&gt; new Promise((resolve, reject) =&gt; {
  someDatabaseThing(maybeAnID, function(error, result)) {
    //...Once we get back the thing from the database...
    if(error) {
        reject(doSomethingWithTheError(error));
    } else {
        resolve(doSomethingWithResult(result));
    }
  }
}
</code></pre>
<p>The call to asynchronous function is simply wrapped in a promise that is returned which allows
chaining with <code>.then()</code> which is much more readable then the <em>callback hell</em> style coding.</p>
<p>Or we can have our own function that returns a promise without wrapping a callback API.</p>
<pre><code class="language-javascript">let myfunc = (param) =&gt; new Promise((resolve, reject) =&gt; {
  // Do stuff that takes time using param
  ...
  if(error) {
      reject(doSomethingWithTheError(error));
  } else {
      resolve(doSomethingWithResult(result));
  }
}
</code></pre>
<p>The functions that consume a function returning a promise can use <code>.then()</code>
chaining. However there is yet another cleaner alternative.
In a function we can use <code>await</code> to invoke a function that returns a promise.
This will make the execution wait till the promise is resolved or rejected.
We don't need to use <code>.then()</code> chaining, which improves readability further more.
A function that wants to use <code>await</code> must be declared with <code>async</code> keyword.</p>
<p>More details here,</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function</a></li>
<li><a href="https://levelup.gitconnected.com/async-await-vs-promises-4fe98d11038f">https://levelup.gitconnected.com/async-await-vs-promises-4fe98d11038f</a></li>
<li><a href="https://www.freecodecamp.org/news/how-to-write-a-javascript-promise-4ed8d44292b8/">https://www.freecodecamp.org/news/how-to-write-a-javascript-promise-4ed8d44292b8/</a></li>
<li><a href="https://medium.com/@sebelga/simplify-your-code-adding-hooks-to-your-promises-9e1483662dfa">https://medium.com/@sebelga/simplify-your-code-adding-hooks-to-your-promises-9e1483662dfa</a></li>
</ul>
<p><code>async</code> function always returns a promise.</p>
<p>from a regular function they can be called with <code>.then()</code></p>
<pre><code class="language-javascript">let v = new Promise((resolve, reject) =&gt; {
    // throw Error("Returning error");
    resolve(20);
});

async function abc() {
    // test rejected promise
    // r will be undefined in case there is an error
    let r = await v.catch(() =&gt; {});
    console.log(r);
    return 35;
}

async function pqr() {
    console.log("running abc");
    let p = await abc();
    console.log(p);
}

// unused return value which is a promise
// This is perfectly acceptable if
// there was no result to return
pqr(); 

// this is how we retrieve return value from 
// an async function from a regular function
// or top level as we can't use await
// however module top level can be made async
abc().then(val =&gt; console.log(val));

</code></pre>
<h2 id="clipboard-api"><a class="header" href="#clipboard-api">clipboard API</a></h2>
<p>modern web browsers provide api for clipboard access</p>
<ul>
<li><a href="https://www.sitepoint.com/clipboard-api/">https://www.sitepoint.com/clipboard-api/</a></li>
</ul>
<h2 id="tree-implementation-in-node"><a class="header" href="#tree-implementation-in-node">tree implementation in node</a></h2>
<pre><code>const dirTree = require("directory-tree");

function printtree(indent, tree, last) {
    let myindent = last ? "'": "|";
    console.log(`${indent}${myindent}-- ${tree.name}`);
    if ("children" in tree) {
        for (let i=0; i &lt; tree.children.length; i++) {
            let chindent = last ? " ": "|";
            let chlast = i == (tree.children.length-1);
            printtree(indent+chindent+"   ", tree.children[i], chlast);            
        }
    }
}

function tree(path) {
  let dt = dirTree(path);
  printtree("", dt, false);
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../topics/java.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../topics/rust.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../topics/java.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../topics/rust.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
